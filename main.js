/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var _=Object.defineProperty;var ne=Object.getOwnPropertyDescriptor;var se=Object.getOwnPropertyNames;var le=Object.prototype.hasOwnProperty;var re=(c,l)=>{for(var e in l)_(c,e,{get:l[e],enumerable:!0})},ae=(c,l,e,t)=>{if(l&&typeof l=="object"||typeof l=="function")for(let n of se(l))!le.call(c,n)&&n!==e&&_(c,n,{get:()=>l[n],enumerable:!(t=ne(l,n))||t.enumerable});return c};var oe=c=>ae(_({},"__esModule",{value:!0}),c);var ge={};re(ge,{default:()=>P});module.exports=oe(ge);var E=require("obsidian");function S(){}S.prototype={diff:function(l,e){var t,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=n.callback;typeof n=="function"&&(i=n,n={}),this.options=n;var s=this;function r(y){return i?(setTimeout(function(){i(void 0,y)},0),!0):y}l=this.castInput(l),e=this.castInput(e),l=this.removeEmpty(this.tokenize(l)),e=this.removeEmpty(this.tokenize(e));var d=e.length,g=l.length,a=1,f=d+g;n.maxEditLength&&(f=Math.min(f,n.maxEditLength));var v=(t=n.timeout)!==null&&t!==void 0?t:1/0,h=Date.now()+v,u=[{oldPos:-1,lastComponent:void 0}],p=this.extractCommon(u[0],e,l,0);if(u[0].oldPos+1>=g&&p+1>=d)return r([{value:this.join(e),count:e.length}]);var o=-1/0,m=1/0;function w(){for(var y=Math.max(o,-a);y<=Math.min(m,a);y+=2){var b=void 0,D=u[y-1],L=u[y+1];D&&(u[y-1]=void 0);var C=!1;if(L){var T=L.oldPos-y;C=L&&0<=T&&T<d}var G=D&&D.oldPos+1<g;if(!C&&!G){u[y]=void 0;continue}if(!G||C&&D.oldPos+1<L.oldPos?b=s.addToPath(L,!0,void 0,0):b=s.addToPath(D,void 0,!0,1),p=s.extractCommon(b,e,l,y),b.oldPos+1>=g&&p+1>=d)return r(ce(s,b.lastComponent,e,l,s.useLongestToken));u[y]=b,b.oldPos+1>=g&&(m=Math.min(m,y-1)),p+1>=d&&(o=Math.max(o,y+1))}a++}if(i)(function y(){setTimeout(function(){if(a>f||Date.now()>h)return i();w()||y()},0)})();else for(;a<=f&&Date.now()<=h;){var x=w();if(x)return x}},addToPath:function(l,e,t,n){var i=l.lastComponent;return i&&i.added===e&&i.removed===t?{oldPos:l.oldPos+n,lastComponent:{count:i.count+1,added:e,removed:t,previousComponent:i.previousComponent}}:{oldPos:l.oldPos+n,lastComponent:{count:1,added:e,removed:t,previousComponent:i}}},extractCommon:function(l,e,t,n){for(var i=e.length,s=t.length,r=l.oldPos,d=r-n,g=0;d+1<i&&r+1<s&&this.equals(e[d+1],t[r+1]);)d++,r++,g++;return g&&(l.lastComponent={count:g,previousComponent:l.lastComponent}),l.oldPos=r,d},equals:function(l,e){return this.options.comparator?this.options.comparator(l,e):l===e||this.options.ignoreCase&&l.toLowerCase()===e.toLowerCase()},removeEmpty:function(l){for(var e=[],t=0;t<l.length;t++)l[t]&&e.push(l[t]);return e},castInput:function(l){return l},tokenize:function(l){return l.split("")},join:function(l){return l.join("")}};function ce(c,l,e,t,n){for(var i=[],s;l;)i.push(l),s=l.previousComponent,delete l.previousComponent,l=s;i.reverse();for(var r=0,d=i.length,g=0,a=0;r<d;r++){var f=i[r];if(f.removed){if(f.value=c.join(t.slice(a,a+f.count)),a+=f.count,r&&i[r-1].added){var h=i[r-1];i[r-1]=i[r],i[r]=h}}else{if(!f.added&&n){var v=e.slice(g,g+f.count);v=v.map(function(p,o){var m=t[a+o];return m.length>p.length?m:p}),f.value=c.join(v)}else f.value=c.join(e.slice(g,g+f.count));g+=f.count,f.added||(a+=f.count)}}var u=i[d-1];return d>1&&typeof u.value=="string"&&(u.added||u.removed)&&c.equals("",u.value)&&(i[d-2].value+=u.value,i.pop()),i}var de=new S;function H(c,l,e){return de.diff(c,l,e)}var ee=/^[A-Za-z\xC0-\u02C6\u02C8-\u02D7\u02DE-\u02FF\u1E00-\u1EFF]+$/,te=/\S/,ie=new S;ie.equals=function(c,l){return this.options.ignoreCase&&(c=c.toLowerCase(),l=l.toLowerCase()),c===l||this.options.ignoreWhitespace&&!te.test(c)&&!te.test(l)};ie.tokenize=function(c){for(var l=c.split(/([^\S\r\n]+|[()[\]{}'"\r\n]|\b)/),e=0;e<l.length-1;e++)!l[e+1]&&l[e+2]&&ee.test(l[e])&&ee.test(l[e+2])&&(l[e]+=l[e+2],l.splice(e+1,2),e--);return l};var R=new S;R.tokenize=function(c){this.options.stripTrailingCr&&(c=c.replace(/\r\n/g,`
`));var l=[],e=c.split(/(\n|\r\n)/);e[e.length-1]||e.pop();for(var t=0;t<e.length;t++){var n=e[t];t%2&&!this.options.newlineIsToken?l[l.length-1]+=n:(this.options.ignoreWhitespace&&(n=n.trim()),l.push(n))}return l};function q(c,l,e){return R.diff(c,l,e)}var pe=new S;pe.tokenize=function(c){return c.split(/(\S.+?[.!?])(?=\s+|$)/)};var fe=new S;fe.tokenize=function(c){return c.split(/([{}:;,]|\s+)/)};function A(c){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?A=function(l){return typeof l}:A=function(l){return l&&typeof Symbol=="function"&&l.constructor===Symbol&&l!==Symbol.prototype?"symbol":typeof l},A(c)}var ue=Object.prototype.toString,M=new S;M.useLongestToken=!0;M.tokenize=R.tokenize;M.castInput=function(c){var l=this.options,e=l.undefinedReplacement,t=l.stringifyReplacer,n=t===void 0?function(i,s){return typeof s=="undefined"?e:s}:t;return typeof c=="string"?c:JSON.stringify(V(c,null,null,n),n,"  ")};M.equals=function(c,l){return S.prototype.equals.call(M,c.replace(/,([\r\n])/g,"$1"),l.replace(/,([\r\n])/g,"$1"))};function V(c,l,e,t,n){l=l||[],e=e||[],t&&(c=t(n,c));var i;for(i=0;i<l.length;i+=1)if(l[i]===c)return e[i];var s;if(ue.call(c)==="[object Array]"){for(l.push(c),s=new Array(c.length),e.push(s),i=0;i<c.length;i+=1)s[i]=V(c[i],l,e,t,n);return l.pop(),e.pop(),s}if(c&&c.toJSON&&(c=c.toJSON()),A(c)==="object"&&c!==null){l.push(c),s={},e.push(s);var r=[],d;for(d in c)c.hasOwnProperty(d)&&r.push(d);for(r.sort(),i=0;i<r.length;i+=1)d=r[i],s[d]=V(c[d],l,e,t,d);l.pop(),e.pop()}else s=c;return s}var j=new S;j.tokenize=function(c){return c.slice()};j.join=j.removeEmpty=function(c){return c};var F=require("obsidian");function O(c){let l=c.container.createDiv({cls:"duplicate-filter-bar"}),e=l.createDiv({cls:"duplicate-filter-left"});e.createEl("span",{text:"\u7B5B\u9009\u6761\u4EF6:",cls:"action-label"});let t=e.createEl("select",{cls:"duplicate-filter-select"});t.createEl("option",{value:"title_content",text:"\u6807\u9898\u548C\u5185\u5BB9\u5B8C\u5168\u76F8\u540C"}),t.createEl("option",{value:"title_exact",text:"\u6807\u9898\u5B8C\u5168\u76F8\u540C"}),t.createEl("option",{value:"title_partial",text:"\u6807\u9898\u90E8\u5206\u91CD\u590D"}),t.value=c.mode,t.addEventListener("change",()=>{c.onModeChange(t.value)});let n=l.createDiv({cls:"duplicate-stats"});return{statsEl:n,filterSelect:t,setStats:i=>{n.setText(i)}}}function B(c){let l=c.container.createDiv({cls:"duplicate-progress-container"}),e=l.createDiv({cls:"duplicate-progress-header"}),t=e.createSpan({cls:"duplicate-progress-title",text:"\u6B63\u5728\u626B\u63CF\u6587\u4EF6..."}),n=e.createSpan({cls:"duplicate-progress-percent",text:"0%"}),s=l.createDiv({cls:"duplicate-progress-bar-outer"}).createDiv({cls:"duplicate-progress-bar-inner"}),r=l.createDiv({cls:"duplicate-progress-details"}),d=r.createSpan({cls:"duplicate-progress-stats",text:"\u51C6\u5907\u4E2D..."});return r.createEl("button",{text:"\u53D6\u6D88",cls:"duplicate-cancel-btn"}).addEventListener("click",()=>c.onCancel()),{root:l,setProgress:(a,f,v,h)=>{let u=v>0?Math.round(f/v*100):0;t.setText(a),n.setText(`${u}%`),s.style.width=`${u}%`,d.setText(`\u5DF2\u626B\u63CF ${f.toLocaleString()} / ${v.toLocaleString()} \u4E2A\u6587\u4EF6\uFF0C\u53D1\u73B0 ${h} \u7EC4\u91CD\u590D`)},remove:()=>l.remove()}}var he='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>',z=class extends F.Modal{constructor(e,t,n,i){super(e);this.title=t,this.message=n,this.onConfirm=i}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:this.title}),e.createEl("p",{text:this.message});let t=e.createDiv({cls:"modal-button-container"});t.style.display="flex",t.style.justifyContent="flex-end",t.style.gap="8px",t.style.marginTop="20px",t.createEl("button",{text:"\u53D6\u6D88"}).addEventListener("click",()=>{this.onConfirm(!1),this.close()}),t.createEl("button",{text:"\u786E\u8BA4\u5220\u9664",cls:"mod-warning"}).addEventListener("click",()=>{this.onConfirm(!0),this.close()})}onClose(){let{contentEl:e}=this;e.empty()}},$=class extends F.Modal{constructor(e,t){super(e);this.allGroups=[];this.filteredGroups=[];this.allGroupsPartial=[];this.filterMode="title_content";this.contentsLoaded=!1;this.isScanning=!1;this.scanAborted=!1;this.containerEl_content=null;this.currentGroupIndex=0;this.uiRendered=!1;this.statsDiv=null;this.progressContainer=null;this.fileMap=new Map;this.partialRebuildTick=0;this.EARLY_RENDER_GROUPS=10;this.selectedQuickAction="ctime_earlier";this.skipConfirmDeleteSelected=!1;this.quickActionButtons={};this.deleteSelectedBtn=null;this.isDeletingSelected=!1;this.plugin=t}async onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("duplicate-files-modal"),e.addClass("duplicate-seq-modal"),this.modalEl.style.width="90vw",this.modalEl.style.maxWidth="1200px",this.modalEl.style.height="80vh";let t=e.createDiv({cls:"duplicate-header"});t.createEl("h2",{text:"\u8FDE\u7EED\u5220\u9664\u91CD\u590D\u6587\u4EF6"});let n=t.createSpan({cls:"duplicate-header-icon"});n.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path><rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect></svg>',this.isScanning=!0,this.renderFilterBar();let i=B({container:e,onCancel:()=>{this.scanAborted=!0,this.close()}});this.progressContainer=i.root,this.containerEl_content=e.createDiv({cls:"duplicate-content"}),await this.scanDuplicateFiles(i.setProgress),!this.scanAborted&&(this.progressContainer&&(this.progressContainer.remove(),this.progressContainer=null),this.renderMainUI())}renderMainUI(){if(this.uiRendered){this.updateStats(this.statsDiv),this.renderCurrentGroup();return}this.uiRendered=!0;let{contentEl:e}=this;this.containerEl_content||(this.containerEl_content=e.createDiv({cls:"duplicate-content"})),this.renderCurrentGroup();let t=e.createDiv({cls:"duplicate-action-bar duplicate-action-bar-seq"}),i=t.createDiv({cls:"duplicate-action-row"}).createDiv({cls:"duplicate-action-left"});i.createEl("span",{text:"\u9ED8\u8BA4\u52FE\u9009:",cls:"action-label"}),[{id:"ctime_earlier",label:"\u4FDD\u7559\u6700\u65E9\u521B\u5EFA",icon:"\u{1F4C5}",action:()=>this.setQuickAction("ctime_earlier")},{id:"ctime_later",label:"\u4FDD\u7559\u6700\u665A\u521B\u5EFA",icon:"\u{1F195}",action:()=>this.setQuickAction("ctime_later")},{id:"mtime_earlier",label:"\u4FDD\u7559\u6700\u65E9\u4FEE\u6539",icon:"\u270F\uFE0F",action:()=>this.setQuickAction("mtime_earlier")},{id:"mtime_later",label:"\u4FDD\u7559\u6700\u665A\u4FEE\u6539",icon:"\u{1F4DD}",action:()=>this.setQuickAction("mtime_later")}].forEach(u=>{let p=i.createEl("button",{cls:"duplicate-quick-btn"});p.createSpan({text:u.icon,cls:"btn-icon"}),p.createSpan({text:u.label}),p.addEventListener("click",u.action),this.quickActionButtons[u.id]=p});let r=i.createEl("button",{cls:"duplicate-quick-btn duplicate-clear-btn"});r.createSpan({text:"\u6E05\u9664\u52FE\u9009"}),r.addEventListener("click",()=>this.clearAllSelections());let d=i.createEl("button",{cls:"duplicate-quick-btn"});d.createSpan({text:"\u53CD\u9009"}),d.addEventListener("click",()=>this.invertSelections()),this.updateQuickActionUI();let a=t.createDiv({cls:"duplicate-action-row"}).createDiv({cls:"duplicate-action-right"}),f=a.createEl("label",{cls:"duplicate-skip-confirm"}),v=f.createEl("input",{type:"checkbox"});v.checked=this.plugin.settings.skipConfirmDeleteSelected,this.skipConfirmDeleteSelected=this.plugin.settings.skipConfirmDeleteSelected,f.createSpan({text:"\u4E0D\u9700\u8981\u4E8C\u6B21\u786E\u8BA4\u5220\u9664"}),v.addEventListener("change",()=>{this.skipConfirmDeleteSelected=v.checked,this.plugin.settings.skipConfirmDeleteSelected=this.skipConfirmDeleteSelected,this.plugin.saveSettings()}),this.deleteSelectedBtn=a.createEl("button",{cls:"mod-warning duplicate-delete-selected-btn"}),this.deleteSelectedBtn.createSpan({cls:"btn-icon",text:"\u{1F5D1}\uFE0F"}),this.deleteSelectedBtn.createSpan({text:"\u5220\u9664\u5DF2\u52FE\u9009"}),this.deleteSelectedBtn.addEventListener("click",()=>this.deleteSelectedInCurrentGroup());let h=a.createEl("button",{cls:"duplicate-quick-btn duplicate-next-btn"});h.createSpan({text:"\u4E0B\u4E00\u7EC4"}),h.addEventListener("click",()=>this.nextGroup())}renderFilterBar(){let{contentEl:e}=this;if(this.statsDiv)return;let t=O({container:e,mode:this.filterMode,onModeChange:async n=>{this.filterMode=n,this.filterMode==="title_content"&&!this.contentsLoaded&&await this.loadContentsForFilter(),this.filterMode==="title_partial"&&(this.allGroupsPartial=this.buildPartialTitleGroups(this.fileMap,this.plugin.settings.partialTitleAlnumMinLength,this.plugin.settings.partialTitleCjkMinLength)),this.applyFilter(!1)}});this.statsDiv=t.statsEl,this.updateStats(this.statsDiv)}async scanDuplicateFiles(e){this.isScanning=!0;let t=this.app.vault.getMarkdownFiles(),n=t.length,i=new Map;this.fileMap=i,e("\u6B63\u5728\u5206\u7EC4\u6587\u4EF6...",0,n,0),t.forEach(a=>{let f=a.basename;i.has(f)||i.set(f,[]),i.get(f).push(a)});let s=Array.from(i.entries()).filter(([a,f])=>f.length>=2),r=s.reduce((a,[f,v])=>a+v.length,0),d=0,g=50;e("\u6B63\u5728\u8BFB\u53D6\u6587\u4EF6\u4FE1\u606F\u548C\u5185\u5BB9...",0,r,s.length);for(let[a,f]of s){if(this.scanAborted)return;let v=[];for(let h=0;h<f.length;h+=g){if(this.scanAborted)return;let u=f.slice(h,h+g),p=await Promise.all(u.map(async o=>{let m=await this.app.vault.adapter.stat(o.path),w="";try{w=await this.app.vault.read(o)}catch(x){w=""}return{file:o,ctime:(m==null?void 0:m.ctime)||0,mtime:(m==null?void 0:m.mtime)||0,content:w,contentLoaded:!0,selected:!1}}));v.push(...p),d+=u.length,e("\u6B63\u5728\u8BFB\u53D6\u6587\u4EF6\u4FE1\u606F\u548C\u5185\u5BB9...",d,r,this.allGroups.length),await new Promise(o=>setTimeout(o,0))}if(this.allGroups.push({basename:a,files:v.sort((h,u)=>h.ctime-u.ctime)}),this.filterMode==="title_content"){let h=v.map(u=>u.content);h.length>0&&h.every(u=>u===h[0])&&this.filteredGroups.push(this.allGroups[this.allGroups.length-1])}else this.filterMode==="title_exact"&&this.filteredGroups.push(this.allGroups[this.allGroups.length-1]);!this.uiRendered&&this.filteredGroups.length>=this.EARLY_RENDER_GROUPS?(this.applyQuickSelectionToCurrentGroup(),this.renderMainUI()):this.uiRendered&&this.updateStats(this.statsDiv),this.filterMode==="title_partial"&&(this.partialRebuildTick++,this.partialRebuildTick%20===0&&(this.allGroupsPartial=this.buildPartialTitleGroups(this.fileMap,this.plugin.settings.partialTitleAlnumMinLength,this.plugin.settings.partialTitleCjkMinLength),this.uiRendered&&this.applyFilter(!0)))}this.allGroups.sort((a,f)=>f.files.length-a.files.length),this.contentsLoaded=!0,this.allGroupsPartial=this.buildPartialTitleGroups(i,this.plugin.settings.partialTitleAlnumMinLength,this.plugin.settings.partialTitleCjkMinLength),this.applyFilter(!0),this.currentGroupIndex=Math.min(this.currentGroupIndex,Math.max(0,this.filteredGroups.length-1)),this.uiRendered&&(this.updateStats(this.statsDiv),this.renderCurrentGroup()),this.isScanning=!1}async loadContentsForFilter(){if(this.contentsLoaded)return;let e=new F.Notice("\u6B63\u5728\u52A0\u8F7D\u6587\u4EF6\u5185\u5BB9\u8FDB\u884C\u6BD4\u8F83...",0),t=0,n=this.allGroups.reduce((i,s)=>i+s.files.filter(r=>!r.contentLoaded).length,0);for(let i of this.allGroups)for(let s of i.files)if(!s.contentLoaded){try{s.content=await this.app.vault.read(s.file),s.contentLoaded=!0}catch(r){s.content="",s.contentLoaded=!0}t++,t%100===0&&(e.setMessage(`\u6B63\u5728\u52A0\u8F7D\u6587\u4EF6\u5185\u5BB9... ${t}/${n}`),await new Promise(r=>setTimeout(r,0)))}this.contentsLoaded=!0,e.hide()}buildPartialTitleGroups(e,t,n){let i=Array.from(e.keys());if(t<=0&&n<=0)return[];let s=new Map;this.allGroups.forEach(o=>{o.files.forEach(m=>s.set(m.file.path,m))});let r=new Map,d=o=>/[a-z0-9]/i.test(o),g=o=>/[\u4e00-\u9fff]/.test(o),a=(o,m,w,x)=>{if(m<=0||o.length<m)return;let y=x?o.toLowerCase():o;for(let b=0;b<=y.length-m;b++)w.add(y.slice(b,b+m))};i.forEach(o=>{let m=new Set,w="",x="other",y=()=>{x==="alnum"?a(w,t,m,!0):x==="cjk"&&a(w,n,m,!1),w="",x="other"};for(let b of o)d(b)?(x!=="alnum"&&y(),x="alnum",w+=b):g(b)?(x!=="cjk"&&y(),x="cjk",w+=b):y();y(),m.forEach(b=>{r.has(b)||r.set(b,new Set),r.get(b).add(o)})});let f=new Map,v=o=>{var x;let m=(x=f.get(o))!=null?x:o;if(m===o)return o;let w=v(m);return f.set(o,w),w},h=(o,m)=>{let w=v(o),x=v(m);w!==x&&f.set(w,x)};i.forEach(o=>f.set(o,o)),r.forEach(o=>{let m=Array.from(o);for(let w=1;w<m.length;w++)h(m[0],m[w])});let u=new Map;i.forEach(o=>{let m=v(o);u.has(m)||u.set(m,[]),u.get(m).push(o)});let p=[];return u.forEach(o=>{let m=[];o.forEach(w=>{var y;let x=(y=e.get(w))!=null?y:[];m=m.concat(x.map(b=>{var L,C,T,G;let D=s.get(b.path);return D||{file:b,ctime:(C=(L=b.stat)==null?void 0:L.ctime)!=null?C:0,mtime:(G=(T=b.stat)==null?void 0:T.mtime)!=null?G:0,contentLoaded:!1,selected:!1}}))}),m.length>=2&&p.push({basename:o.join(" / "),files:m})}),p}applyFilter(e=!1){this.filterMode==="title_content"?this.filteredGroups=this.allGroups.filter(t=>{let n=t.files.map(i=>i.content);return n.every(i=>i===n[0])}):this.filterMode==="title_exact"?this.filteredGroups=[...this.allGroups]:this.filteredGroups=[...this.allGroupsPartial],e?this.currentGroupIndex=Math.min(this.currentGroupIndex,Math.max(0,this.filteredGroups.length-1)):this.currentGroupIndex=0,this.applyQuickSelectionToCurrentGroup(),this.renderCurrentGroup(),this.updateStats(this.contentEl.querySelector(".duplicate-stats"))}updateStats(e){e.empty();let t=this.filteredGroups.length;if(t===0){let s=this.isScanning?"\uFF08\u7EE7\u7EED\u626B\u63CF\u4E2D...\uFF09":"";e.setText(`\u672A\u627E\u5230\u91CD\u590D\u6587\u4EF6 ${s}`);return}let n=this.filteredGroups[this.currentGroupIndex],i=this.isScanning?"\uFF08\u7EE7\u7EED\u626B\u63CF\u4E2D...\uFF09":"";e.setText(`\u5F53\u524D\u7B2C ${this.currentGroupIndex+1} / ${t} \u7EC4\uFF0C\u7EC4\u5185 ${n.files.length} \u4E2A\u6587\u4EF6 ${i}`)}renderCurrentGroup(){if(!this.containerEl_content)return;if(this.containerEl_content.empty(),this.filteredGroups.length===0){let a=this.containerEl_content.createDiv({cls:"duplicate-empty"});this.isScanning?(a.createSpan({cls:"duplicate-empty-icon",text:"\u2026"}),a.createEl("p",{text:"\u6B63\u5728\u626B\u63CF\u4E2D\uFF0C\u8BF7\u7A0D\u5019\u2026"})):(a.createSpan({cls:"duplicate-empty-icon",text:"\u2713"}),a.createEl("p",{text:"\u592A\u68D2\u4E86\uFF01\u672A\u627E\u5230\u91CD\u590D\u6587\u4EF6\u540D\u7684\u7B14\u8BB0"}));return}let e=this.filteredGroups[this.currentGroupIndex],t=this.containerEl_content.createDiv({cls:"duplicate-group"}),n=t.createDiv({cls:"duplicate-group-header"});n.createSpan({cls:"duplicate-group-name",text:`\u{1F4C4} ${e.basename}`}),n.createSpan({cls:"duplicate-group-count",text:`${e.files.length} \u4E2A\u6587\u4EF6`}),n.createEl("button",{text:"Diff \u5BF9\u6BD4",cls:"duplicate-diff-btn"}).addEventListener("click",()=>this.openGroupDiff(e));let s=t.createEl("table",{cls:"duplicate-table"}),d=s.createEl("thead").createEl("tr");d.createEl("th",{text:"\u9009\u62E9"}),d.createEl("th",{text:"\u8DEF\u5F84"}),d.createEl("th",{text:"\u521B\u5EFA\u65F6\u95F4"}),d.createEl("th",{text:"\u4FEE\u6539\u65F6\u95F4"}),d.createEl("th",{text:"\u64CD\u4F5C"});let g=s.createEl("tbody");e.files.forEach((a,f)=>{let v=g.createEl("tr"),u=v.createEl("td").createEl("input",{type:"checkbox"});u.checked=a.selected,u.dataset.groupIndex=String(this.currentGroupIndex),u.dataset.fileIndex=String(f),u.addEventListener("change",()=>{a.selected=u.checked}),v.createEl("td",{cls:"duplicate-path-cell"}).createEl("a",{text:a.file.path,cls:"duplicate-file-link"}).addEventListener("click",x=>{x.preventDefault(),this.app.workspace.openLinkText(a.file.path,"",!1)}),v.createEl("td",{text:this.formatTime(a.ctime)}),v.createEl("td",{text:this.formatTime(a.mtime)});let w=v.createEl("td",{cls:"duplicate-action-cell"}).createEl("button",{cls:"duplicate-delete-btn"});w.innerHTML=he,w.setAttribute("aria-label","\u5220\u9664\u6587\u4EF6"),w.addEventListener("click",()=>this.deleteSingleFile(e,a))})}formatTime(e){return e?new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-"}selectByTime(e,t){if(this.filteredGroups.length===0)return;let n=this.filteredGroups[this.currentGroupIndex],i=[...n.files].sort((s,r)=>s[e]-r[e]);if(n.files.forEach(s=>s.selected=!1),t==="earlier"){let s=i[0];n.files.forEach(r=>{r!==s&&(r.selected=!0)})}else{let s=i[i.length-1];n.files.forEach(r=>{r!==s&&(r.selected=!0)})}this.renderCurrentGroup()}clearAllSelections(){if(this.filteredGroups.length===0)return;this.filteredGroups[this.currentGroupIndex].files.forEach(t=>t.selected=!1),this.renderCurrentGroup()}invertSelections(){if(this.filteredGroups.length===0)return;this.filteredGroups[this.currentGroupIndex].files.forEach(t=>t.selected=!t.selected),this.renderCurrentGroup()}async deleteSingleFile(e,t){if(await this.showConfirmDialog("\u786E\u8BA4\u5220\u9664",`\u786E\u5B9A\u8981\u5220\u9664\u6587\u4EF6 "${t.file.path}" \u5417\uFF1F\u6B64\u64CD\u4F5C\u4E0D\u53EF\u64A4\u9500\u3002`))try{await this.app.fileManager.trashFile(t.file);let i=e.files.indexOf(t);if(i>-1&&e.files.splice(i,1),e.files.length<2){let s=this.allGroups.indexOf(e);s>-1&&this.allGroups.splice(s,1);let r=this.filteredGroups.indexOf(e);r>-1&&this.filteredGroups.splice(r,1),this.currentGroupIndex>=this.filteredGroups.length&&(this.currentGroupIndex=Math.max(0,this.filteredGroups.length-1))}this.renderCurrentGroup(),this.updateStats(this.contentEl.querySelector(".duplicate-stats")),new F.Notice(`\u5DF2\u5220\u9664: ${t.file.path}`)}catch(i){new F.Notice(`\u5220\u9664\u5931\u8D25: ${i.message}`,5e3)}}async deleteSelectedInCurrentGroup(){var i,s,r;if(this.isDeletingSelected||this.filteredGroups.length===0)return;let e=this.filteredGroups[this.currentGroupIndex],t=e.files.filter(d=>d.selected);if(t.length===0){new F.Notice("\u8BF7\u5148\u52FE\u9009\u8981\u5220\u9664\u7684\u6587\u4EF6");return}if(this.skipConfirmDeleteSelected?!0:await this.showConfirmDialog("\u786E\u8BA4\u6279\u91CF\u5220\u9664",`\u786E\u5B9A\u8981\u5220\u9664\u9009\u4E2D\u7684 ${t.length} \u4E2A\u6587\u4EF6\u5417\uFF1F\u6B64\u64CD\u4F5C\u4E0D\u53EF\u64A4\u9500\u3002`)){this.setDeleteSelectedLoading(!0);let d=0,g=0,a=[];for(let h of t)try{await this.app.fileManager.trashFile(h.file);let u=e.files.indexOf(h);u>-1&&e.files.splice(u,1),d++}catch(u){g++;let p=u!=null&&u.message?String(u.message):"\u672A\u77E5\u9519\u8BEF";a.push({path:h.file.path,message:p}),console.error(`\u5220\u9664\u5931\u8D25: ${h.file.path}`,u)}if(g>0){this.setDeleteSelectedLoading(!1),this.renderCurrentGroup(),this.updateStats(this.contentEl.querySelector(".duplicate-stats"));let h=a.slice(0,5).map(p=>`${p.path}: ${p.message}`).join(`
`),u=a.length>5?`
...\u4EE5\u53CA\u5176\u4ED6 ${a.length-5} \u6761`:"";new F.Notice(`\u5220\u9664\u5931\u8D25 ${g} \u4E2A:
${h}${u}`,8e3);return}if(e.files.length<2){let h=this.allGroups.indexOf(e);h>-1&&this.allGroups.splice(h,1);let u=this.filteredGroups.indexOf(e);u>-1&&this.filteredGroups.splice(u,1),this.currentGroupIndex>=this.filteredGroups.length&&(this.currentGroupIndex=Math.max(0,this.filteredGroups.length-1))}this.applyQuickSelectionToCurrentGroup(),this.renderCurrentGroup(),this.updateStats(this.contentEl.querySelector(".duplicate-stats"));let f=(r=(s=(i=t[0])==null?void 0:i.file)==null?void 0:s.basename)!=null?r:"",v=d>1?`\u7B49${d}\u4E2A\u6587\u4EF6`:"\u6587\u4EF6";new F.Notice(`\u5DF2\u5220\u9664 ${f}${v}`),this.setDeleteSelectedLoading(!1)}}setDeleteSelectedLoading(e){this.isDeletingSelected=e,this.deleteSelectedBtn&&(e?(this.deleteSelectedBtn.addClass("is-loading"),this.deleteSelectedBtn.disabled=!0):(this.deleteSelectedBtn.removeClass("is-loading"),this.deleteSelectedBtn.disabled=!1))}setQuickAction(e){this.selectedQuickAction=e,this.updateQuickActionUI(),this.applyQuickSelectionToCurrentGroup(),this.renderCurrentGroup()}updateQuickActionUI(){Object.entries(this.quickActionButtons).forEach(([e,t])=>{e===this.selectedQuickAction?t.addClass("is-selected"):t.removeClass("is-selected")})}applyQuickSelectionToCurrentGroup(){if(this.filteredGroups.length===0)return;let e=this.filteredGroups[this.currentGroupIndex];if(e)switch(this.selectedQuickAction){case"ctime_earlier":this.applySelection("ctime","earlier",e);break;case"ctime_later":this.applySelection("ctime","later",e);break;case"mtime_earlier":this.applySelection("mtime","earlier",e);break;case"mtime_later":this.applySelection("mtime","later",e);break;default:break}}applySelection(e,t,n){let i=[...n.files].sort((s,r)=>{let d=s[e]-r[e];if(t==="later"){if(d!==0)return-d}else if(d!==0)return d;let g=s.file.path.includes("/"),a=r.file.path.includes("/");return g===a?0:g?-1:1});if(n.files.forEach(s=>s.selected=!1),t==="earlier"){let s=i[0];n.files.forEach(r=>{r!==s&&(r.selected=!0)})}else{let s=i[i.length-1];n.files.forEach(r=>{r!==s&&(r.selected=!0)})}}async openGroupDiff(e){let t=e.files.map(n=>n.file);t.length===2?await this.plugin.openDiffView(t[0],t[1]):t.length>=3&&await this.plugin.openMultiDiffView(t.slice(0,3))}nextGroup(){if(this.filteredGroups.length!==0){if(this.currentGroupIndex>=this.filteredGroups.length-1){new F.Notice("\u5DF2\u5230\u6700\u540E\u4E00\u7EC4");return}this.currentGroupIndex++,this.applyQuickSelectionToCurrentGroup(),this.renderCurrentGroup(),this.updateStats(this.contentEl.querySelector(".duplicate-stats"))}}showConfirmDialog(e,t){return new Promise(n=>{new z(this.app,e,t,n).open()})}onClose(){let{contentEl:e}=this;e.empty()}};var me='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>',N=class{constructor(l){this.groupElements=new Map;this.app=l.app,this.plugin=l.plugin,this.container=l.container,this.groups=l.groups,this.onDeleteFile=l.onDeleteFile,this.onOpenDiff=l.onOpenDiff}render(){if(this.container.empty(),this.container.addClass("duplicate-list-container"),this.groupElements.clear(),this.groups.length===0){this.container.createDiv({cls:"duplicate-list-empty"}).setText("\u6CA1\u6709\u5339\u914D\u7684\u6570\u636E");return}let l=document.createDocumentFragment();this.groups.forEach((e,t)=>{let n=this.renderGroup(e,t);l.appendChild(n),this.groupElements.set(t,n)}),this.container.appendChild(l)}renderGroup(l,e){let t=document.createElement("div");t.className="duplicate-group",t.dataset.groupIndex=String(e);let n=document.createElement("div");n.className="duplicate-group-header";let i=document.createElement("span");i.className="duplicate-group-name",i.textContent=`\u{1F4C4} ${l.basename}`,n.appendChild(i);let s=document.createElement("span");s.className="duplicate-group-count",s.textContent=`${l.files.length} \u4E2A\u6587\u4EF6`,n.appendChild(s);let r=document.createElement("button");r.className="duplicate-diff-btn",r.textContent="Diff \u5BF9\u6BD4",r.addEventListener("click",()=>this.onOpenDiff(l)),n.appendChild(r),t.appendChild(n);let d=document.createElement("table");d.className="duplicate-table";let g=document.createElement("thead"),a=document.createElement("tr");["\u9009\u62E9","\u8DEF\u5F84","\u521B\u5EFA\u65F6\u95F4","\u4FEE\u6539\u65F6\u95F4","\u64CD\u4F5C"].forEach(v=>{let h=document.createElement("th");h.textContent=v,a.appendChild(h)}),g.appendChild(a),d.appendChild(g);let f=document.createElement("tbody");return l.files.forEach(v=>{let h=this.renderFileRow(l,v);f.appendChild(h)}),d.appendChild(f),t.appendChild(d),t}renderFileRow(l,e){let t=document.createElement("tr"),n=document.createElement("td"),i=document.createElement("input");i.type="checkbox",i.checked=e.selected,i.addEventListener("change",()=>{e.selected=i.checked}),n.appendChild(i),t.appendChild(n);let s=document.createElement("td");s.className="duplicate-path-cell";let r=document.createElement("a");r.className="duplicate-file-link",r.textContent=e.file.path,r.title=e.file.path,r.addEventListener("click",v=>{v.preventDefault(),this.app.workspace.openLinkText(e.file.path,"",!1)}),s.appendChild(r),t.appendChild(s);let d=document.createElement("td");d.textContent=this.formatTime(e.ctime),t.appendChild(d);let g=document.createElement("td");g.textContent=this.formatTime(e.mtime),t.appendChild(g);let a=document.createElement("td");a.className="duplicate-action-cell";let f=document.createElement("button");return f.className="duplicate-delete-btn",f.innerHTML=me,f.setAttribute("aria-label","\u5220\u9664\u6587\u4EF6"),f.addEventListener("click",async()=>{await this.onDeleteFile(l,e)}),a.appendChild(f),t.appendChild(a),t}formatTime(l){return l?new Date(l).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-"}updateGroups(l){this.groups=l,this.render()}removeGroup(l){let e=this.groupElements.get(l);e&&(e.remove(),this.groupElements.delete(l))}refreshGroup(l){let e=this.groups[l];if(!e)return;let t=this.groupElements.get(l);if(t){let n=this.renderGroup(e,l);t.replaceWith(n),this.groupElements.set(l,n)}}cleanup(){this.groupElements.clear()}};var W="file-diff-view",Q="multi-file-diff-view",U={partialTitleAlnumMinLength:10,partialTitleCjkMinLength:6,skipConfirmDeleteSelected:!1},k=class extends E.FuzzySuggestModal{constructor(e,t,n){super(e);this.onChoose=t,this.excludeFile=n,this.setPlaceholder("\u9009\u62E9\u8981\u6BD4\u8F83\u7684\u6587\u4EF6...")}getItems(){return this.app.vault.getMarkdownFiles().filter(e=>e!==this.excludeFile).sort((e,t)=>e.path.localeCompare(t.path))}getItemText(e){return e.path}onChooseItem(e,t){this.onChoose(e)}},I=class extends E.Modal{constructor(e,t,n,i){super(e);this.title=t,this.message=n,this.onConfirm=i}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:this.title}),e.createEl("p",{text:this.message});let t=e.createDiv({cls:"modal-button-container"});t.style.display="flex",t.style.justifyContent="flex-end",t.style.gap="8px",t.style.marginTop="20px",t.createEl("button",{text:"\u53D6\u6D88"}).addEventListener("click",()=>{this.onConfirm(!1),this.close()}),t.createEl("button",{text:"\u786E\u8BA4\u5220\u9664",cls:"mod-warning"}).addEventListener("click",()=>{this.onConfirm(!0),this.close()})}onClose(){let{contentEl:e}=this;e.empty()}},J=class extends E.ItemView{constructor(e){super(e);this.file1=null;this.file2=null;this.content1="";this.content2=""}getViewType(){return W}getDisplayText(){return this.file1&&this.file2?`Diff: ${this.file1.basename} \u2194 ${this.file2.basename}`:"File Diff"}getIcon(){return"git-compare"}async setFiles(e,t){this.file1=e,this.file2=t,this.content1=await this.app.vault.read(e),this.content2=await this.app.vault.read(t),this.render()}async deleteFile(e,t){if(!e)return;if(await this.showConfirmDialog(`\u786E\u8BA4\u5220\u9664${t}`,`\u786E\u5B9A\u8981\u5220\u9664\u6587\u4EF6 "${e.path}" \u5417\uFF1F\u6B64\u64CD\u4F5C\u4E0D\u53EF\u64A4\u9500\u3002`))try{await this.app.fileManager.trashFile(e),this.leaf.detach()}catch(i){new E.Notice(`\u5220\u9664\u6587\u4EF6\u5931\u8D25: ${i.message}`,5e3),console.error("\u5220\u9664\u6587\u4EF6\u5931\u8D25:",i)}}showConfirmDialog(e,t){return new Promise(n=>{new I(this.app,e,t,n).open()})}render(){var h,u;let e=this.containerEl.children[1];e.empty(),e.addClass("diff-view-container");let t=e.createDiv({cls:"diff-header"}),n=t.createDiv({cls:"diff-file-info diff-file-old"});n.createSpan({cls:"diff-file-label",text:"\u6587\u4EF6\u4E00\uFF08\u5DE6\uFF09: "}),n.createSpan({cls:"diff-file-name",text:((h=this.file1)==null?void 0:h.path)||""});let i=n.createSpan({cls:"diff-file-delete clickable-icon"});i.setAttribute("aria-label","\u5220\u9664\u6587\u4EF6\u4E00"),i.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>',i.addEventListener("click",async()=>{await this.deleteFile(this.file1,"\u6587\u4EF6\u4E00")});let s=t.createDiv({cls:"diff-file-info diff-file-new"});s.createSpan({cls:"diff-file-label",text:"\u6587\u4EF6\u4E8C\uFF08\u53F3\uFF09: "}),s.createSpan({cls:"diff-file-name",text:((u=this.file2)==null?void 0:u.path)||""});let r=s.createSpan({cls:"diff-file-delete clickable-icon"});r.setAttribute("aria-label","\u5220\u9664\u6587\u4EF6\u4E8C"),r.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>',r.addEventListener("click",async()=>{await this.deleteFile(this.file2,"\u6587\u4EF6\u4E8C")});let d=this.calculateStats(),g=t.createDiv({cls:"diff-stats"});if(g.createSpan({cls:"diff-stat-add",text:`+${d.additions}`}),g.createSpan({cls:"diff-stat-del",text:`-${d.deletions}`}),!q(this.content1,this.content2).some(p=>p.added||p.removed)){e.createDiv({cls:"diff-no-change"}).setText("\u4E24\u4E2A\u6587\u4EF6\u5185\u5BB9\u76F8\u540C\uFF0C\u6CA1\u6709\u5DEE\u5F02");return}let v=e.createDiv({cls:"diff-content-split"});this.renderSplitDiff(v)}calculateStats(){let e=H(this.content1,this.content2),t=0,n=0;return e.forEach(i=>{i.added?t+=i.value.length:i.removed&&(n+=i.value.length)}),{additions:t,deletions:n}}renderSplitDiff(e){let t=this.content1.split(`
`),n=this.content2.split(`
`),i=q(this.content1,this.content2),s=[],r=0,d=0;i.forEach(h=>{let u=h.value.split(`
`);u[u.length-1]===""&&u.pop(),h.added?u.forEach(p=>{s.push({left:null,right:p,type:"added"}),d++}):h.removed?u.forEach(p=>{s.push({left:p,right:null,type:"removed"}),r++}):u.forEach(p=>{s.push({left:p,right:p,type:"same"}),r++,d++})});let g=[],a=0;for(;a<s.length;){let h=s[a];if(h.type==="removed"){let u=[h.left],p=a+1;for(;p<s.length&&s[p].type==="removed";)u.push(s[p].left),p++;let o=[];for(;p<s.length&&s[p].type==="added";)o.push(s[p].right),p++;let m=Math.max(u.length,o.length);for(let w=0;w<m;w++){let x=w<u.length?u[w]:null,y=w<o.length?o[w]:null;x!==null&&y!==null?g.push({left:x,right:y,type:"modified"}):x!==null?g.push({left:x,right:null,type:"removed"}):y!==null&&g.push({left:null,right:y,type:"added"})}a=p}else g.push(h),a++}let f=1,v=1;g.forEach(h=>{let u=e.createDiv({cls:"diff-row"}),p=u.createDiv({cls:"diff-col diff-col-left"});if(h.left!==null){h.type==="removed"?p.addClass("diff-line-del"):h.type==="modified"&&p.addClass("diff-line-modified-old"),p.createSpan({cls:"diff-line-num",text:String(f++)});let m=p.createSpan({cls:"diff-line-content"});h.type==="modified"&&h.right!==null?this.renderCharDiff(m,h.left,h.right,"old"):m.setText(h.left||" ")}else p.addClass("diff-line-empty"),p.createSpan({cls:"diff-line-num",text:""}),p.createSpan({cls:"diff-line-content",text:" "});let o=u.createDiv({cls:"diff-col diff-col-right"});if(h.right!==null){h.type==="added"?o.addClass("diff-line-add"):h.type==="modified"&&o.addClass("diff-line-modified-new"),o.createSpan({cls:"diff-line-num",text:String(v++)});let m=o.createSpan({cls:"diff-line-content"});h.type==="modified"&&h.left!==null?this.renderCharDiff(m,h.left,h.right,"new"):m.setText(h.right||" ")}else o.addClass("diff-line-empty"),o.createSpan({cls:"diff-line-num",text:""}),o.createSpan({cls:"diff-line-content",text:" "})})}renderCharDiff(e,t,n,i){H(t,n).forEach(r=>{if(i==="old")if(r.removed){let d=e.createSpan({cls:"diff-char-del",text:r.value})}else r.added||e.createSpan({text:r.value});else if(r.added){let d=e.createSpan({cls:"diff-char-add",text:r.value})}else r.removed||e.createSpan({text:r.value})}),e.textContent===""&&e.setText(" ")}async onOpen(){}async onClose(){}},Y=class extends E.ItemView{constructor(e){super(e);this.files=[];this.contents=[]}getViewType(){return Q}getDisplayText(){return this.files.length>0?`Diff: ${this.files.map(e=>e.basename).join(" \u2194 ")}`:"Multi File Diff"}getIcon(){return"git-compare"}async setFiles(e){this.files=e,this.contents=await Promise.all(e.map(t=>this.app.vault.read(t))),this.render()}async deleteFile(e,t){if(await this.showConfirmDialog(`\u786E\u8BA4\u5220\u9664\u6587\u4EF6${t+1}`,`\u786E\u5B9A\u8981\u5220\u9664\u6587\u4EF6 "${e.path}" \u5417\uFF1F\u6B64\u64CD\u4F5C\u4E0D\u53EF\u64A4\u9500\u3002`))try{await this.app.fileManager.trashFile(e),this.files.splice(t,1),this.contents.splice(t,1),this.files.length>=2?(this.render(),new E.Notice(`\u5DF2\u5220\u9664\u6587\u4EF6\uFF0C\u7EE7\u7EED\u5BF9\u6BD4\u5269\u4F59 ${this.files.length} \u4E2A\u6587\u4EF6`)):this.leaf.detach()}catch(i){new E.Notice(`\u5220\u9664\u6587\u4EF6\u5931\u8D25: ${i.message}`,5e3)}}showConfirmDialog(e,t){return new Promise(n=>{new I(this.app,e,t,n).open()})}render(){let e=this.containerEl.children[1];e.empty(),e.addClass("diff-view-container"),e.addClass("multi-diff-view");let t=e.createDiv({cls:"diff-header multi-diff-header"});if(this.files.forEach((s,r)=>{let d=t.createDiv({cls:`diff-file-info diff-file-${r}`});d.createSpan({cls:"diff-file-label",text:`\u6587\u4EF6${r+1}: `}),d.createSpan({cls:"diff-file-name",text:s.path});let g=d.createSpan({cls:"diff-file-delete clickable-icon"});g.setAttribute("aria-label",`\u5220\u9664\u6587\u4EF6${r+1}`),g.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>',g.addEventListener("click",()=>this.deleteFile(s,r))}),this.contents.every(s=>s===this.contents[0])){e.createDiv({cls:"diff-no-change"}).setText(`${this.files.length}\u4E2A\u6587\u4EF6\u5185\u5BB9\u76F8\u540C\uFF0C\u6CA1\u6709\u5DEE\u5F02`);return}let i=e.createDiv({cls:"diff-content-split multi-diff-content"});i.style.setProperty("--column-count",String(this.files.length)),this.renderMultiDiff(i)}renderMultiDiff(e){let t=this.contents.map(i=>i.split(`
`)),n=Math.max(...t.map(i=>i.length));for(let i=0;i<n;i++){let s=e.createDiv({cls:"diff-row"}),r=t.map(a=>{var f;return(f=a[i])!=null?f:null}),d=r.filter(a=>a!==null),g=d.length>0&&!d.every(a=>a===d[0]);r.forEach((a,f)=>{let v=s.createDiv({cls:"diff-col"});if(a!==null){if(g){let u=r.filter(p=>p===a).length;u===1?v.addClass("diff-line-unique"):u<this.files.length&&v.addClass("diff-line-partial")}v.createSpan({cls:"diff-line-num",text:String(i+1)});let h=v.createSpan({cls:"diff-line-content"});g&&d.length>1?this.renderCharDiffMulti(h,a,r,f):h.setText(a||" ")}else v.addClass("diff-line-empty"),v.createSpan({cls:"diff-line-num",text:""}),v.createSpan({cls:"diff-line-content",text:" "})})}}renderCharDiffMulti(e,t,n,i){let s=n.filter((g,a)=>g!==null&&a!==i);if(s.length===0){e.setText(t||" ");return}let r=s.find(g=>g!==t)||s[0];H(r,t).forEach(g=>{g.added?e.createSpan({cls:"diff-char-add",text:g.value}):g.removed||e.createSpan({text:g.value})}),e.textContent===""&&e.setText(" ")}async onOpen(){}async onClose(){}},X=class extends E.Modal{constructor(e,t){super(e);this.allGroups=[];this.filteredGroups=[];this.allGroupsPartial=[];this.filterMode="title_content";this.containerEl_content=null;this.isScanning=!1;this.scanAborted=!1;this.contentsLoaded=!1;this.statsDiv=null;this.progressContainer=null;this.fileMap=new Map;this.duplicateList=null;this.plugin=t}async onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("duplicate-files-modal"),this.modalEl.style.width="90vw",this.modalEl.style.maxWidth="1200px",this.modalEl.style.height="80vh";let t=e.createDiv({cls:"duplicate-header"});t.createEl("h2",{text:"\u5168\u5C40\u91CD\u590D\u6587\u4EF6\u67E5\u627E"});let n=t.createSpan({cls:"duplicate-header-icon"});n.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path><rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect></svg>',this.renderFilterBar();let i=B({container:e,onCancel:()=>{this.scanAborted=!0,this.close()}});if(this.progressContainer=i.root,await this.scanDuplicateFiles(i.setProgress),!this.scanAborted){if(this.progressContainer&&(this.progressContainer.remove(),this.progressContainer=null),this.allGroups.length===0){let s=e.createDiv({cls:"duplicate-empty"});s.createSpan({cls:"duplicate-empty-icon",text:"\u2713"}),s.createEl("p",{text:"\u592A\u68D2\u4E86\uFF01\u672A\u627E\u5230\u91CD\u590D\u6587\u4EF6\u540D\u7684\u7B14\u8BB0"});return}this.renderMainUI()}}renderMainUI(){let{contentEl:e}=this;this.statsDiv&&this.updateStats(this.statsDiv),this.containerEl_content=e.createDiv({cls:"duplicate-content"}),this.renderGroups();let t=e.createDiv({cls:"duplicate-action-bar"}),n=t.createDiv({cls:"duplicate-action-left"});n.createEl("span",{text:"\u5FEB\u901F\u52FE\u9009:",cls:"action-label"}),[{label:"\u4FDD\u7559\u6700\u65E9\u521B\u5EFA",icon:"\u{1F4C5}",action:()=>this.selectByTime("ctime","earlier")},{label:"\u4FDD\u7559\u6700\u665A\u521B\u5EFA",icon:"\u{1F195}",action:()=>this.selectByTime("ctime","later")},{label:"\u4FDD\u7559\u6700\u65E9\u4FEE\u6539",icon:"\u270F\uFE0F",action:()=>this.selectByTime("mtime","earlier")},{label:"\u4FDD\u7559\u6700\u665A\u4FEE\u6539",icon:"\u{1F4DD}",action:()=>this.selectByTime("mtime","later")}].forEach(a=>{let f=n.createEl("button",{cls:"duplicate-quick-btn"});f.createSpan({text:a.icon,cls:"btn-icon"}),f.createSpan({text:a.label}),f.addEventListener("click",a.action)});let s=n.createEl("button",{cls:"duplicate-quick-btn duplicate-clear-btn"});s.createSpan({text:"\u6E05\u9664\u52FE\u9009"}),s.addEventListener("click",()=>this.clearAllSelections());let r=n.createEl("button",{cls:"duplicate-quick-btn"});r.createSpan({text:"\u53CD\u9009"}),r.addEventListener("click",()=>this.invertSelections());let g=t.createDiv({cls:"duplicate-action-right"}).createEl("button",{cls:"mod-warning duplicate-delete-selected-btn"});g.createSpan({cls:"btn-icon",text:"\u{1F5D1}\uFE0F"}),g.createSpan({text:"\u5220\u9664\u5DF2\u52FE\u9009"}),g.addEventListener("click",()=>this.deleteSelected())}async scanDuplicateFiles(e){this.isScanning=!0;let t=this.app.vault.getMarkdownFiles(),n=t.length,i=new Map;this.fileMap=i,e("\u6B63\u5728\u5206\u7EC4\u6587\u4EF6...",0,n,0),t.forEach(a=>{let f=a.basename;i.has(f)||i.set(f,[]),i.get(f).push(a)});let s=Array.from(i.entries()).filter(([a,f])=>f.length>=2),r=s.reduce((a,[f,v])=>a+v.length,0),d=0,g=50;e("\u6B63\u5728\u8BFB\u53D6\u6587\u4EF6\u4FE1\u606F\u548C\u5185\u5BB9...",0,r,s.length);for(let[a,f]of s){if(this.scanAborted)return;let v=[];for(let h=0;h<f.length;h+=g){if(this.scanAborted)return;let u=f.slice(h,h+g),p=await Promise.all(u.map(async o=>{let m=await this.app.vault.adapter.stat(o.path),w="";try{w=await this.app.vault.read(o)}catch(x){w=""}return{file:o,ctime:(m==null?void 0:m.ctime)||0,mtime:(m==null?void 0:m.mtime)||0,content:w,contentLoaded:!0,selected:!1}}));v.push(...p),d+=u.length,e("\u6B63\u5728\u8BFB\u53D6\u6587\u4EF6\u4FE1\u606F\u548C\u5185\u5BB9...",d,r,this.allGroups.length),await new Promise(o=>setTimeout(o,0))}this.allGroups.push({basename:a,files:v.sort((h,u)=>h.ctime-u.ctime)})}this.allGroups.sort((a,f)=>f.files.length-a.files.length),this.contentsLoaded=!0,this.allGroupsPartial=this.buildPartialTitleGroups(i,this.plugin.settings.partialTitleAlnumMinLength,this.plugin.settings.partialTitleCjkMinLength),this.applyFilter(),this.isScanning=!1}renderFilterBar(){let{contentEl:e}=this;if(this.statsDiv)return;let t=O({container:e,mode:this.filterMode,onModeChange:async n=>{this.filterMode=n,this.filterMode==="title_content"&&!this.contentsLoaded&&await this.loadContentsForFilter(),this.filterMode==="title_partial"&&(this.allGroupsPartial=this.buildPartialTitleGroups(this.fileMap,this.plugin.settings.partialTitleAlnumMinLength,this.plugin.settings.partialTitleCjkMinLength)),this.applyFilter()}});this.statsDiv=t.statsEl,this.updateStats(this.statsDiv)}async loadContentsForFilter(){if(this.contentsLoaded)return;let e=new E.Notice("\u6B63\u5728\u52A0\u8F7D\u6587\u4EF6\u5185\u5BB9\u8FDB\u884C\u6BD4\u8F83...",0),t=0,n=this.allGroups.reduce((i,s)=>i+s.files.filter(r=>!r.contentLoaded).length,0);for(let i of this.allGroups)for(let s of i.files)if(!s.contentLoaded){try{s.content=await this.app.vault.read(s.file),s.contentLoaded=!0}catch(r){s.content="",s.contentLoaded=!0}t++,t%100===0&&(e.setMessage(`\u6B63\u5728\u52A0\u8F7D\u6587\u4EF6\u5185\u5BB9... ${t}/${n}`),await new Promise(r=>setTimeout(r,0)))}this.contentsLoaded=!0,e.hide()}buildPartialTitleGroups(e,t,n){let i=Array.from(e.keys());if(t<=0&&n<=0)return[];let s=new Map,r=p=>/[a-z0-9]/i.test(p),d=p=>/[\u4e00-\u9fff]/.test(p),g=(p,o,m,w)=>{if(o<=0||p.length<o)return;let x=w?p.toLowerCase():p;for(let y=0;y<=x.length-o;y++)m.add(x.slice(y,y+o))};i.forEach(p=>{let o=new Set,m="",w="other",x=()=>{w==="alnum"?g(m,t,o,!0):w==="cjk"&&g(m,n,o,!1),m="",w="other"};for(let y of p)r(y)?(w!=="alnum"&&x(),w="alnum",m+=y):d(y)?(w!=="cjk"&&x(),w="cjk",m+=y):x();x(),o.forEach(y=>{s.has(y)||s.set(y,new Set),s.get(y).add(p)})});let a=new Map,f=p=>{var w;let o=(w=a.get(p))!=null?w:p;if(o===p)return p;let m=f(o);return a.set(p,m),m},v=(p,o)=>{let m=f(p),w=f(o);m!==w&&a.set(m,w)};i.forEach(p=>a.set(p,p)),s.forEach(p=>{let o=Array.from(p);for(let m=1;m<o.length;m++)v(o[0],o[m])});let h=new Map;i.forEach(p=>{let o=f(p);h.has(o)||h.set(o,[]),h.get(o).push(p)});let u=[];return h.forEach(p=>{let o=[];p.forEach(m=>{var x;let w=(x=e.get(m))!=null?x:[];o=o.concat(w.map(y=>{var b,D,L,C;return{file:y,ctime:(D=(b=y.stat)==null?void 0:b.ctime)!=null?D:0,mtime:(C=(L=y.stat)==null?void 0:L.mtime)!=null?C:0,contentLoaded:!1,selected:!1}}))}),o.length>=2&&u.push({basename:p.join(" / "),files:o})}),u}applyFilter(){this.filterMode==="title_content"?this.filteredGroups=this.allGroups.filter(e=>{let t=e.files.map(n=>n.content);return t.every(n=>n===t[0])}):this.filterMode==="title_exact"?this.filteredGroups=[...this.allGroups]:this.filteredGroups=[...this.allGroupsPartial],this.renderGroups(),this.updateStats(this.contentEl.querySelector(".duplicate-stats"))}updateStats(e){e.empty();let t=this.filteredGroups.length,n=this.filteredGroups.reduce((i,s)=>i+s.files.length,0);e.setText(`\u627E\u5230 ${t} \u7EC4\u91CD\u590D\u6587\u4EF6\uFF0C\u5171 ${n} \u4E2A\u6587\u4EF6`)}renderGroups(){this.containerEl_content&&(this.duplicateList&&this.duplicateList.cleanup(),this.duplicateList=new N({app:this.app,plugin:this.plugin,container:this.containerEl_content,groups:this.filteredGroups,onDeleteFile:async(e,t)=>{await this.deleteSingleFile(e,t)},onOpenDiff:e=>{this.openGroupDiff(e)}}),this.duplicateList.render())}selectByTime(e,t){this.filteredGroups.forEach(n=>{let i=[...n.files].sort((s,r)=>s[e]-r[e]);if(n.files.forEach(s=>s.selected=!1),t==="earlier"){let s=i[0];n.files.forEach(r=>{r!==s&&(r.selected=!0)})}else{let s=i[i.length-1];n.files.forEach(r=>{r!==s&&(r.selected=!0)})}}),this.renderGroups()}clearAllSelections(){this.allGroups.forEach(e=>{e.files.forEach(t=>t.selected=!1)}),this.renderGroups()}invertSelections(){this.filteredGroups.forEach(e=>{e.files.forEach(t=>t.selected=!t.selected)}),this.renderGroups()}async deleteSingleFile(e,t){if(await this.showConfirmDialog("\u786E\u8BA4\u5220\u9664",`\u786E\u5B9A\u8981\u5220\u9664\u6587\u4EF6 "${t.file.path}" \u5417\uFF1F\u6B64\u64CD\u4F5C\u4E0D\u53EF\u64A4\u9500\u3002`))try{await this.app.fileManager.trashFile(t.file);let i=e.files.indexOf(t);if(i>-1&&e.files.splice(i,1),e.files.length<2){let s=this.allGroups.indexOf(e);s>-1&&this.allGroups.splice(s,1);let r=this.filteredGroups.indexOf(e);r>-1&&this.filteredGroups.splice(r,1)}this.renderGroups(),this.updateStats(this.contentEl.querySelector(".duplicate-stats")),new E.Notice(`\u5DF2\u5220\u9664: ${t.file.path}`)}catch(i){new E.Notice(`\u5220\u9664\u5931\u8D25: ${i.message}`,5e3)}}async deleteSelected(){let e=[];if(this.filteredGroups.forEach(n=>{n.files.forEach(i=>{i.selected&&e.push({group:n,fileInfo:i})})}),e.length===0){new E.Notice("\u8BF7\u5148\u52FE\u9009\u8981\u5220\u9664\u7684\u6587\u4EF6");return}if(await this.showConfirmDialog("\u786E\u8BA4\u6279\u91CF\u5220\u9664",`\u786E\u5B9A\u8981\u5220\u9664\u9009\u4E2D\u7684 ${e.length} \u4E2A\u6587\u4EF6\u5417\uFF1F\u6B64\u64CD\u4F5C\u4E0D\u53EF\u64A4\u9500\u3002`)){let n=0,i=0;for(let{group:s,fileInfo:r}of e)try{await this.app.fileManager.trashFile(r.file);let d=s.files.indexOf(r);d>-1&&s.files.splice(d,1),n++}catch(d){i++,console.error(`\u5220\u9664\u5931\u8D25: ${r.file.path}`,d)}this.allGroups=this.allGroups.filter(s=>s.files.length>=2),this.applyFilter(),new E.Notice(`\u5220\u9664\u5B8C\u6210: \u6210\u529F ${n} \u4E2A, \u5931\u8D25 ${i} \u4E2A`)}}async openGroupDiff(e){let t=e.files.map(n=>n.file);t.length===2?await this.plugin.openDiffView(t[0],t[1]):t.length>=3&&await this.plugin.openMultiDiffView(t.slice(0,3))}showConfirmDialog(e,t){return new Promise(n=>{new I(this.app,e,t,n).open()})}onClose(){this.duplicateList&&(this.duplicateList.cleanup(),this.duplicateList=null);let{contentEl:e}=this;e.empty()}},Z=class extends E.Modal{constructor(e,t,n,i){super(e);this.selectedFiles=new Set;this.currentFile=t,this.similarFiles=n,this.onConfirm=i,this.selectedFiles.add(t)}onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("similar-files-modal"),e.createEl("h2",{text:"\u67E5\u627E\u5230\u76F8\u4F3C\u6587\u4EF6"}),e.createEl("p",{text:`\u5F53\u524D\u6587\u4EF6: ${this.currentFile.basename}`}),e.createEl("p",{cls:"similar-files-hint",text:"\u8BF7\u9009\u62E9\u8981\u5BF9\u6BD4\u7684\u6587\u4EF6\uFF08\u6700\u591A\u9009\u62E93\u4E2A\uFF09:"});let t=e.createDiv({cls:"similar-files-list"}),n=t.createDiv({cls:"similar-file-item current-file"}),i=n.createEl("input",{type:"checkbox"});i.checked=!0,i.disabled=!0,n.createSpan({text:`${this.currentFile.path} (\u5F53\u524D\u6587\u4EF6)`}),this.similarFiles.forEach((g,a)=>{let f=t.createDiv({cls:"similar-file-item"}),v=f.createEl("input",{type:"checkbox"});a<2&&(v.checked=!0,this.selectedFiles.add(g)),v.addEventListener("change",()=>{if(v.checked){if(this.selectedFiles.size>=3){v.checked=!1,new E.Notice("\u6700\u591A\u53EA\u80FD\u9009\u62E93\u4E2A\u6587\u4EF6\u8FDB\u884C\u5BF9\u6BD4");return}this.selectedFiles.add(g)}else this.selectedFiles.delete(g)}),f.createSpan({text:g.path})});let s=e.createDiv({cls:"modal-button-container"});s.style.display="flex",s.style.justifyContent="flex-end",s.style.gap="8px",s.style.marginTop="20px",s.createEl("button",{text:"\u53D6\u6D88"}).addEventListener("click",()=>this.close()),s.createEl("button",{text:"\u5F00\u59CB\u5BF9\u6BD4",cls:"mod-cta"}).addEventListener("click",()=>{if(this.selectedFiles.size<2){new E.Notice("\u8BF7\u81F3\u5C11\u9009\u62E92\u4E2A\u6587\u4EF6\u8FDB\u884C\u5BF9\u6BD4");return}this.onConfirm(Array.from(this.selectedFiles)),this.close()})}onClose(){let{contentEl:e}=this;e.empty()}},P=class extends E.Plugin{constructor(){super(...arguments);this.selectedFile=null}async onload(){console.log("File Diff Plugin loaded"),await this.loadSettings(),this.addSettingTab(new K(this.app,this)),this.registerView(W,e=>new J(e)),this.registerView(Q,e=>new Y(e)),this.registerEvent(this.app.workspace.on("files-menu",(e,t)=>{let n=t.filter(i=>i instanceof E.TFile&&i.extension==="md");n.length===2&&e.addItem(i=>{i.setTitle("Diff: \u5BF9\u6BD4\u9009\u4E2D\u7684\u4E24\u4E2A\u6587\u4EF6").setIcon("git-compare").onClick(async()=>{await this.openDiffView(n[0],n[1])})})})),this.registerEvent(this.app.workspace.on("file-menu",(e,t)=>{t instanceof E.TFile&&t.extension==="md"&&(this.selectedFile?(e.addItem(n=>{var i;n.setTitle(`Diff: \u4E0E "${(i=this.selectedFile)==null?void 0:i.basename}" \u6BD4\u8F83`).setIcon("git-compare").onClick(async()=>{this.selectedFile&&(await this.openDiffView(this.selectedFile,t),this.selectedFile=null)})}),e.addItem(n=>{n.setTitle("Diff: \u91CD\u65B0\u8BBE\u4E3A\u6BD4\u8F83\u6E90").setIcon("refresh-cw").onClick(()=>{this.selectedFile=t,new E.Notice(`\u5DF2\u66F4\u65B0\u6BD4\u8F83\u6E90\u4E3A "${t.basename}"`)})}),e.addItem(n=>{n.setTitle("Diff: \u6E05\u9664\u6BD4\u8F83\u6E90").setIcon("x").onClick(()=>{this.selectedFile=null,new E.Notice("\u5DF2\u6E05\u9664\u6BD4\u8F83\u6E90")})})):e.addItem(n=>{n.setTitle("Diff: \u8BBE\u4E3A\u6BD4\u8F83\u6E90").setIcon("git-compare").onClick(()=>{this.selectedFile=t,new E.Notice(`\u5DF2\u9009\u62E9 "${t.basename}" \u4F5C\u4E3A\u6BD4\u8F83\u6E90`)})}))})),this.addCommand({id:"compare-two-files",name:"\u6BD4\u8F83\u4E24\u4E2A\u6587\u4EF6",callback:()=>{this.selectAndCompareFiles()}}),this.addCommand({id:"compare-with-current",name:"\u9009\u62E9\u6587\u4EF6\u4E0E\u5F53\u524D\u6587\u4EF6\u6BD4\u8F83",checkCallback:e=>{let t=this.app.workspace.getActiveFile();return t&&t.extension==="md"?(e||new k(this.app,async n=>{await this.openDiffView(t,n)},t).open(),!0):!1}}),this.addCommand({id:"clear-diff-source",name:"\u6E05\u9664\u6BD4\u8F83\u6E90",callback:()=>{this.selectedFile=null,new E.Notice("\u5DF2\u6E05\u9664\u6BD4\u8F83\u6E90")}}),this.addCommand({id:"find-similar-files-and-diff",name:"\u67E5\u627E\u76F8\u4F3C\u6587\u4EF6\u540D\u5E76\u5BF9\u6BD4",checkCallback:e=>{let t=this.app.workspace.getActiveFile();return t&&t.extension==="md"?(e||this.findSimilarFilesAndDiff(t),!0):!1}}),this.addCommand({id:"find-all-duplicate-files",name:"\u5168\u5C40\u67E5\u627E\u91CD\u590D\u6587\u4EF6\u540D",callback:()=>{new X(this.app,this).open()}}),this.addCommand({id:"continuous-delete-duplicate-files",name:"\u8FDE\u7EED\u5220\u9664\u91CD\u590D\u6587\u4EF6",callback:()=>{new $(this.app,this).open()}})}findSimilarFilesAndDiff(e){let t=e.basename,i=this.app.vault.getMarkdownFiles().filter(s=>s.path===e.path?!1:!!(s.basename===t||s.basename.includes(t)));if(i.length===0){new E.Notice(`\u672A\u627E\u5230\u4E0E "${t}" \u76F8\u4F3C\u7684\u6587\u4EF6`);return}new Z(this.app,e,i,async s=>{await navigator.clipboard.writeText(e.name),new E.Notice(`\u5DF2\u590D\u5236\u6587\u4EF6\u540D: ${e.name}`),s.length===2?await this.openDiffView(s[0],s[1]):s.length===3&&await this.openMultiDiffView(s)}).open()}async openMultiDiffView(e){let t=this.app.workspace.openPopoutLeaf();await t.setViewState({type:Q,active:!0}),await t.view.setFiles(e)}async selectAndCompareFiles(){new k(this.app,e=>{new k(this.app,async t=>{await this.openDiffView(e,t)},e).open()}).open()}async openDiffView(e,t){let n=this.app.workspace.openPopoutLeaf();await n.setViewState({type:W,active:!0}),await n.view.setFiles(e,t)}onunload(){console.log("File Diff Plugin unloaded"),this.selectedFile=null}async loadSettings(){let e=await this.loadData();this.settings=Object.assign({},U,e);let t=e==null?void 0:e.partialTitleMinLength;Number.isFinite(t)&&t>0&&(this.settings.partialTitleCjkMinLength=Math.floor(t))}async saveSettings(){await this.saveData(this.settings)}},K=class extends E.PluginSettingTab{constructor(e,t){super(e,t);this.plugin=t}display(){let{containerEl:e}=this;e.empty(),new E.Setting(e).setName("\u6807\u9898\u90E8\u5206\u91CD\u590D\uFF08\u5B57\u6BCD/\u6570\u5B57\uFF09\u81F3\u5C11\u8FDE\u7EED\u5B57\u7B26\u6570").setDesc("\u7528\u4E8E\u201C\u6807\u9898\u90E8\u5206\u91CD\u590D\u201D\u7B5B\u9009\u6761\u4EF6\uFF08\u5B57\u6BCD/\u6570\u5B57\u8FDE\u7EED\u7247\u6BB5\uFF09\u3002").addText(t=>{t.setPlaceholder(String(U.partialTitleAlnumMinLength)),t.setValue(String(this.plugin.settings.partialTitleAlnumMinLength)),t.onChange(async n=>{let i=Number(n);!Number.isFinite(i)||i<=0||(this.plugin.settings.partialTitleAlnumMinLength=Math.floor(i),await this.plugin.saveSettings())})}),new E.Setting(e).setName("\u6807\u9898\u90E8\u5206\u91CD\u590D\uFF08\u4E2D\u6587\uFF09\u81F3\u5C11\u8FDE\u7EED\u5B57\u7B26\u6570").setDesc("\u7528\u4E8E\u201C\u6807\u9898\u90E8\u5206\u91CD\u590D\u201D\u7B5B\u9009\u6761\u4EF6\uFF08\u4E2D\u6587\u8FDE\u7EED\u7247\u6BB5\uFF09\u3002").addText(t=>{t.setPlaceholder(String(U.partialTitleCjkMinLength)),t.setValue(String(this.plugin.settings.partialTitleCjkMinLength)),t.onChange(async n=>{let i=Number(n);!Number.isFinite(i)||i<=0||(this.plugin.settings.partialTitleCjkMinLength=Math.floor(i),await this.plugin.saveSettings())})})}};
